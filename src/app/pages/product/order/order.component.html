<div class="card-body pb-0">
  <h2 class="card-title text-center mb-0">Order</h2>
  <app-loading *ngIf="loading"></app-loading>
</div>

<ng-template [ngIf]="utils.isLoaded(loading)">
  <!-- Product is over -->
  <div *ngIf="productPast" class="card-body">
    <p class="lead card-text">You cannot Order to an product that has already ended.</p>
  </div>

  <ng-template [ngIf]="!productPast && orders">
    <!-- User has Ordered -->
    <ng-template [ngIf]="userOrder">
      <div class="card-body">
        <p class="lead card-text">You responded to this product with the following information:</p>
      </div>

      <ul *ngIf="!showEditForm" class="list-group list-group-flush">
        <li class="list-group-item">
          <strong>Name:</strong>{{ userOrder.name }}
        </li>
        <li class="list-group-item">
          <strong>Attending:</strong>{{ utils.booleanToText(userOrder.attending) }}
        </li>
        <li *ngIf="userOrder.attending && userOrder.guests" class="list-group-item">
          <strong>Additional Guests:</strong>{{ userOrder.guests }}
        </li>
        <li *ngIf="userOrder.comments" class="list-group-item">
          <strong>Comments:</strong><span [innerHTML]="userOrder.comments"></span>
        </li>
      </ul>

      <div class="card-body">
        <button
          class="btn btn-info"
          [ngClass]="{ 'btn-info': !showEditForm, 'btn-warning': showEditForm }"
          (click)="toggleEditForm()">{{ editBtnText }}</button>

        <app-order-form
          *ngIf="showEditForm"
          [productId]="productId"
          [order]="userOrder"
          (submitOrder)="onSubmitOrder($product)"></app-order-form>
      </div>
    </ng-template>

    <!-- No Order yet -->
    <div *ngIf="!userOrder" class="card-body">
      <p class="lead card-text">Fill out the form below to respond:</p>

      <app-order-form
        [productId]="productId"
        (submitOrder)="onSubmitOrder($product)"></app-order-form>
    </div>
  </ng-template>

  <!-- All Orders -->
  <div class="card-body text-right">
    <button (click)="toggleShowOrders()" class="btn btn-link btn-sm">{{ showOrdersText }}</button>
  </div>

  <section class="allOrders" *ngIf="showAllOrders" [@expandCollapse]>
    <div class="card-body">
      <h3 class="card-title text-center">All Orders</h3>
      <p *ngIf="!orders.length" class="lead card-text">There are currently no Orders for this product.</p>
    </div>

    <ul *ngIf="orders.length" class="list-group list-group-flush">
      <li class="list-group-item list-group-item-success justify-content-between">
        <strong>Attending</strong>
        <span class="badge badge-success badge-pill">{{ totalAttending }}</span>
      </li>
      <li
        *ngFor="let order of fs.filter(orders, 'attending', true)"
        class="list-group-item small">
        {{ order.name }} {{ utils.showPlusOnes(order.guests) }}
        <p *ngIf="auth.isAdmin && order.comments" class="d-flex w-100">
          <em [innerHTML]="order.comments"></em>
        </p>
      </li>
      <li class="list-group-item list-group-item-danger justify-content-between">
        <strong>Not Attending</strong>
        <span class="badge badge-danger badge-pill">{{ fs.filter(orders, 'attending', false).length }}</span>
      </li>
      <li
        *ngFor="let order of fs.filter(orders, 'attending', false)"
        class="list-group-item small">
        {{ order.name }}
        <p *ngIf="auth.isAdmin && order.comments" class="d-flex w-100">
          <em [innerHTML]="order.comments"></em>
        </p>
      </li>
    </ul>
  </section>

  <!-- Error loading Orders -->
  <div *ngIf="error" class="card-body">
    <p class="alert alert-danger">
      <strong>Oops!</strong> There was an error retrieving Orders for this product.
    </p>
  </div>
</ng-template>

<!-- Footer showing # of total attending guests -->
<div class="card-footer text-right">
  <small *ngIf="totalAttending >= 0" class="text-muted">{{ utils.displayCount(totalAttending) }} {{ footerTense }}</small>
</div>
